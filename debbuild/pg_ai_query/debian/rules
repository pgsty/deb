#!/usr/bin/make -f

export CXX = g++
export CC = gcc

%:
	dh $@

PG_VERSIONS = 14 15 16 17 18

override_dh_auto_test:

override_dh_auto_clean:

override_dh_strip:
	dh_strip --no-automatic-dbgsym

override_dh_auto_configure:

override_dh_auto_build:
	for ver in $(PG_VERSIONS); do \
		echo "=== Building for PostgreSQL $$ver ==="; \
		mkdir -p $(CURDIR)/build-pg$$ver; \
		PATH="/usr/lib/postgresql/$$ver/bin:$$PATH" \
		cmake -B $(CURDIR)/build-pg$$ver -S $(CURDIR) \
			-DCMAKE_INSTALL_PREFIX=/usr \
			-DCMAKE_BUILD_TYPE=Release; \
		cmake --build $(CURDIR)/build-pg$$ver -- -j$$(nproc); \
	done

override_dh_auto_install:
	for ver in $(PG_VERSIONS); do \
		DESTDIR=$(CURDIR)/debian/tmp cmake --install $(CURDIR)/build-pg$$ver; \
	done
